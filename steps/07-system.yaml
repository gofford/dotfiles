- defaults:
    link:
      relink: true
      force: true

# Ensure config directories exist
- create:
    - ~/.config/opencode

# Link system configuration files
- link:
    # ssh configuration
    ~/.ssh/config: ~/.dotfiles/ssh/config

    # direnv configuration
    ~/.config/direnv/direnv.toml: ~/.dotfiles/direnv/direnv.toml

    # opencode configuration
    ~/.config/opencode/opencode.json: ~/.dotfiles/opencode/opencode.json
    ~/.config/opencode/dcp.jsonc: ~/.dotfiles/opencode/dcp.jsonc
    ~/.config/opencode/agents: ~/.dotfiles/opencode/agents
    ~/.config/opencode/skills: ~/.dotfiles/opencode/skills
    ~/.config/opencode/commands: ~/.dotfiles/opencode/commands

    # k9s configuration
    ~/.config/k9s:
      glob: true
      path: ~/.dotfiles/k9s/*
      relink: true

    # ghostty configuration
    ~/.config/ghostty/config: ~/.dotfiles/ghostty/config

    # editor configuration
    ~/.editorconfig: ~/.dotfiles/.editorconfig

# Dock configuration
- shell:
    - description: Configure Dock with dockutil
      command: |
        # Require dockutil
        if ! command -v dockutil >/dev/null 2>&1; then
          echo "dockutil not found â€” skipping dock configuration"
          exit 0
        fi

        # Start clean
        dockutil --remove all --no-restart

        # Apps
        dockutil --add "/Applications/Spark.app" --no-restart
        dockutil --add /Applications/Arc.app --no-restart
        dockutil --add /Applications/Slack.app  --no-restart
        dockutil --add /Applications/Ghostty.app --no-restart
        dockutil --add /Applications/Cursor.app  --no-restart
        dockutil --add "/Applications/Sublime Text.app" --no-restart
        dockutil --add /Applications/DataGrip.app --no-restart
        dockutil --add /Applications/Spotify.app --no-restart

        # Apply all changes in one restart
        killall Dock
